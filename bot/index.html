<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
    <title>Bot 2</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
     
</head>
<body>
    <p style="margin-bottom: 3em"></p>
    <div class="container h-100">
		<div class="row">
			<div class="col-md-8 offset-md-1">
                <h1>Vk-bot занятие 2</h1>
                <h4>Ознакомиться с теоретическим материалом по HTTP запросам и ответить на вопросы</h4>
                <p>Ссылка на материалы: <a target="_blank" href="https://evmservice.ru/blog/metody-get-i-post/">тык</a></p>
                <label for="q0" class="form-label">1. В чем принципиальное различие между GET и POST запросами с точки зрения способа передачи данных и ожидаемого действия на сервере?
                    </label>
                <textarea  class="form-control" id="q0"></textarea>
                <br>
                <label for="q1" class="form-label">2. Приведите пример ситуации, когда следует использовать GET запрос, и пример ситуации, когда следует использовать POST запрос.</label>
                <textarea  class="form-control" id="q1"></textarea>
                <br>
                3. Как передаются параметры в GET запросе? (Можно написать пример)
                <textarea  class="form-control" rows="1"></textarea>
                <br>
                4. Какой из запросов ограничен по объему передаваемых данных?
                <textarea  class="form-control" rows="1"></textarea>
                <br>
                5. Какой метод более безопасен для передачи данных?
                <textarea  class="form-control" rows="1"></textarea>
                <br>
                <br>
                <h4>Создать новый туннель и проверить работу бота</h4>
                1. Запустить ngrok
                <br>
                2. Выполнить <i>ngrok http 8000</i>
                <br>
                3. Скопировать новый адрес, с которого происходит переадресация на наш компьютер 
                <br>
                4. Поменять адрес в переменной ALLOWED_HOSTS в файле settings.py
                <br>
                5. Запустить сервер Django
                <br>
                6. Поменять ссылку в вк и проверить, что результат OK
                <br>
                <br>
                <h4> Бот, обрабатывающий события о новых сообщениях</h4>
                1. В вк открывем Callback API => типы событий => ставим галочку на Входящие сообщения
                <br>
                <br>
                2. Снова отправим запрос на подтверждение сервера
                <br>
                <br>
                3. Создание функции, которая реагирует на запросы вк
                <br>
                <br>
                <pre>   3.1. Переименовываем текущую фунцию из <i>index</i> в <i>init</i>, 
    теперь мы будем вызывать ее только в случаях смены адреса сервера</pre>
                <pre>   3.2. Создаем новую функцию index, которая будет принимать запросы вк (код на рисунке ниже)</pre>
                <img src="img/image1.png">
                <br>
                <br>
                Функция index: в первой строке получаем тело запроса, то что отправляет нам на сервер вк, во второй строке используем функцию print, чтобы вывести
                на его экран, в последней строке отправляем вк результат - то, что пакет был успешно получен и обработан, если его не отправить, вк попытается
                отправить нам его снова и снова, что нагружает и вк, и наш сервер
                <br>
                <br>
                4. Сохраняем изменения и запускаем сервер (если не запущен)
                <br>
                <br>
                5. Заходи в сообщения сообщества и пишем что-нибудь)
                <br>
                <br>
                6. Провем в VS Code, что вывелось в консоль (зарпос вк на наш сервер), смотрим из чего он состоит, копируем его и вставляем в поле ниже:
                <textarea  class="form-control"></textarea>
                <br>
                7. Обратим внимание на самые важные элемента этого ответа, напишите в поле ниже, какие значения соответствуют ключам type, group_id, object, id, from_id, text 
                <br>
                <br>
                type - message_new – говорит нам о том, что событие произошедшее в

сообществе это новое входящее сообщение
<br>

group_id - номер сообщества в котором произошло событие
<br>
object - объект содержащий в себе информацию о событии:
<br>
id – номер сообщения в нашем сообществе,
<br>
from_id – идентификатор пользователя, который написал нам это

сообщение
<br>
text - текст сообщения
                <br>
                <br>
                <textarea  class="form-control"></textarea>
                <br>
                <h4> Бот, отвечающий на сообщения</h4>
                1. Теперь для того, чтобы мы смогли отправлять сообщения в ответ, нам понадобиться добавить библиотеку vk api в наш проект,
                выполняем <code>poetry add vk</code> в командной строке
                <br>
                <br>
                2. Импортируем библиотеку в файле views.py с помощью <code>import vk</code>
                <br>
                <br>
                3. Для отправки сообщений нам понадобится ключ доступа, закодим
                в нашего бота, вкладка Callback API => Ключи доступа => нажимаем создать ключ,
                ставим все галочки и создаем ключ
                <br>
                <br>
                4. В файле views.py добавляем следующий код после импорта библиотек
                <br>
                <br>
                <code>vk_api = vk.API(access_token='')</code>
                <br>
                <br>
                Где в переменную access_token мы передаем значение нашего ключа

доступа строкой.
<br>
Важно! Никому не сообщайте данный ключ и не публикуйте его в открытом доступе, поскольку тот кто получит этот ключ сможет управлять вашим сообществом.

                <br>
                <br>
                5. Изменяем функцию для отправки сообщений 
                <br>
                <br>
                <img src="img/image3.png">
                <br>
                <br>
                Обращаем внимание на строку <code>vk_api.messages...</code>,
                именно в этой строке мы отправляем сообщение пользователю, что этот метод принимает:
                user_id - пользователь, которому нужно отправить сообщение, message - текст нашего сообщения, random_id - нужен чтобы сделать сообщение уникальным, чтобы оно не повторялось  и v - определяющая версию. 
                <br>
                <br>
                6. В начале кода импортируем библиотеку random: <code>import random</code>
                <br>
                <br>
                7. Обратите внимание в строке где присутствует второй if, пропушено сравнение, нужно дописать <code> == "Привет"</code>
                <br>
                <br>
                8. Проверяем работу бота :) (Пишем ему "Привет")
                <br>
                <br>
                9. Дописать функцию так, чтобы на сообщение "Как дела?" бот отвечал
                "Хорошо"
                <br>
                <br>
                10. Дописать функцию так, чтобы на сообщение "Как дела?" бот отвечал
                двумя сообщениями "Хорошо" и "Как твои?"
                <br>
                <br>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
